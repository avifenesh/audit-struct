FROM rust:1.85-slim

RUN apt-get update && apt-get install -y gcc g++ && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . .

RUN mkdir -p tests/fixtures/bin && \
    gcc -g -o tests/fixtures/bin/test_simple tests/fixtures/test_simple.c && \
    gcc -g -o tests/fixtures/bin/test_modified tests/fixtures/test_modified.c && \
    g++ -std=c++17 -g -o tests/fixtures/bin/test_cpp_templates tests/fixtures/test_cpp_templates.cpp

CMD ["cargo", "test"]
